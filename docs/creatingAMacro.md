TODO write this

See examples/example.macro for a working example.
